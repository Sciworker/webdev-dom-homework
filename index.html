<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">
        <!-- <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li> -->
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш комментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    "use strict";
    // Код писать здесь
    
    const comments = [
      {author: 'Глеб Фокин', text: 'Это будет первый комментарий на этой странице', date: '12.02.22 12:18', likes: 3, liked: false},
      {author: 'Варвара Н.', text: 'Мне нравится как оформлена эта страница! ❤', date: '13.02.22 19:22', likes: 75, liked: true},
    ];
    // получаем элементы необходимые для работы (используем document.querySelector('.class-name')) - будет искать элемент на странице по названию класса
    // форма
    const form = document.querySelector(".add-form");
    // кнопка формы для добавления комментария
    const addCommentButton = form.querySelector('.add-form-button');
    // добавляем слушатель события на кнопку: при клике будет вызываться функция addComment (см далее)
    addCommentButton.addEventListener("click", addFormComment);
    // получаем контейнер в котором находятся комментарии
    const commentsContainer = document.querySelector(".comments");

    function renderComments(comments) {
      commentsContainer.innerHTML = '';
      for (const comment of comments) {
        commentsContainer.append(createCommentElement(comment));
      }
    }
    renderComments(comments);

    function likeComment() {
      const targetCommentElement = event.target.closest(".comment");
      const comment = comments[Array.from(commentsContainer.children).indexOf(targetCommentElement)];
      // console.log(Array.from(commentsContainer.children).indexOf(targetCommentElement), targetCommentElement, appropriateComment);
      toggleLike(comment);
      renderComments(comments);
      // console.log(comments);
    }

    function toggleLike(comment) {
      comment.liked = !comment.liked;
      if (comment.liked) {
        comment.likes++;
      } else {
        comment.likes--;
      }
    }

    // функция для проверки значений формы, которая будет возвращать true если поля заполнены, иначе - false 
    function validateCommentData({author, text} = {}) {
      // функция принимает объект с полями author и text которые обозначают имя автора и текст соответсвенно
      // делаем trim() чтобы убрать пробелы в начале и в конце - таким образом если пользователь введет три пробела поле будет считаться пустым
      if (author.trim() !== '' && text.trim() !== '') {
        return true;
      } else return false;
    }

    // функция для создания элемента комментария
    // так выглядит html код комментария
    // <li class="comment">
    //   <div class="comment-header">
    //     <div>Глеб Фокин</div>
    //     <div>12.02.22 12:18</div>
    //   </div>
    //   <div class="comment-body">
    //     <div class="comment-text">
    //       Это будет первый комментарий на этой странице
    //     </div>
    //   </div>
    //   <div class="comment-footer">
    //     <div class="likes">
    //       <span class="likes-counter">3</span>
    //       <button class="like-button"></button>
    //     </div>
    //   </div>
    // </li>
    function createCommentElement({author, text, date, likes = 0, liked = false} = {}) {
      // функция принимает объект с полями author text date и likes которые обозначают имя автора текст дата и количество лайков соответственно

      // создаем <li></li>
      const commentElement = document.createElement('li');
      // добавляем ему класс class="comment"
      commentElement.classList.add('comment');

      // вставляем внутрь структуру комментария
      commentElement.innerHTML = `
      <div class="comment-header">
          <div>${author}</div>
          <div>${date}</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">${text}
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">${likes}</span>
            <button class="like-button${liked ? ' -active-like' : ''}" onclick="likeComment()""></button>
          </div>
        </div>
        `;

      // возвращаем сконструированный html код комментария
      return commentElement;
    }

    // функция возвращающая строку даты в нужном формате
    function formatDate(date) {
      // получает объект даты создания комментария
      // каждый параметр даты дополняется 0 спереди если является однозначной цифрой
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = String(date.getFullYear()).slice(-2);
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');

      // возвращаем строку с датой в нужном формате
      return `${day}.${month}.${year} ${hours}:${minutes}`;
    }


    // функция добавления комментария
    function addFormComment() {
      // получаем имя автора из поля ввода формы
      const author = form.querySelector(".add-form-name").value;
      // аналогично получаем текст комментария
      const text = form.querySelector(".add-form-text").value;
      // получаем строку с датой в нужно формате (передаем новосозданный объект Date)
      const date = formatDate(new Date());
      // создаем объект комментария с полями author text date и likes которые обозначают имя автора текст дата и количество лайков соответственно
      const comment = {author, text, date};

      if (validateCommentData(comment)) {
        // если поля не пустые (validateCommentData(comment) вернула true)
        // создаем элемент комментария
        const commentElement = createCommentElement(comment);
        // добавляем его в контейнер комментариев
        comments.push({author, text, date, likes: 0, liked: false})
        commentsContainer.append(commentElement);
        // стираем значения полей ввода формы 
        form.querySelector(".add-form-name").value = '';
        form.querySelector(".add-form-text").value = '';
        // иначе выводим модальное окно с надписью "Не все поля заполнены!"
      } else alert("Не все поля заполнены!");
    }
    
    console.log("It works!");
  </script>
</html>
